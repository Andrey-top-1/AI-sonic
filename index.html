<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–Ω–Ω–∏–∫ - –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –≤–∞—à–∏—Ö —Å–Ω–æ–≤</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6d5dfc;
            --primary-dark: #5b4ce2;
            --secondary: #8a4fff;
            --text: #333;
            --text-light: #666;
            --bg: #f9f7fe;
            --card-bg: #ffffff;
            --user-msg: #e3f2fd;
            --bot-msg: #f3e5f5;
            --error: #f44336;
            --success: #4caf50;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo i {
            font-size: 1.8rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 20px;
            transition: background 0.3s;
        }

        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn-outline:hover {
            background-color: white;
            color: var(--primary);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .section {
            display: none;
            padding: 40px 0;
            min-height: calc(100vh - 80px);
        }

        .section.active {
            display: block;
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.2rem;
            color: var(--primary);
        }

        /* Auth Section */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .auth-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 40px;
            width: 100%;
            max-width: 450px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
        }

        .password-strength {
            height: 5px;
            background-color: #eee;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            transition: width 0.3s;
        }

        .password-weak {
            background-color: var(--error);
            width: 30%;
        }

        .password-medium {
            background-color: orange;
            width: 60%;
        }

        .password-strong {
            background-color: var(--success);
            width: 100%;
        }

        .error-message {
            color: var(--error);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        /* Chat Section */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 70vh;
            max-width: 800px;
            margin: 0 auto;
        }

        .chat-messages {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: var(--bg);
            border-radius: var(--border-radius);
        }

        .message {
            max-width: 80%;
            padding: 15px;
            border-radius: var(--border-radius);
            position: relative;
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--user-msg);
            border-bottom-right-radius: 0;
        }

        .bot-message {
            align-self: flex-start;
            background-color: var(--bot-msg);
            border-bottom-left-radius: 0;
        }

        .message-text {
            margin-bottom: 10px;
        }

        .message-time {
            font-size: 0.8rem;
            color: var(--text-light);
            text-align: right;
        }

        .tts-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1rem;
        }

        /* –£–±—Ä–∞–Ω–∞ –±–µ–ª–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ */
        .input-container {
            display: flex;
            padding: 20px 0;
            gap: 10px;
            justify-content: center;
            background-color: transparent;
        }

        .message-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            resize: none;
            height: 50px;
            max-width: 500px;
            background-color: var(--card-bg);
        }

        .send-button, .voice-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: background 0.3s;
        }

        .send-button:hover, .voice-button:hover {
            background-color: var(--primary-dark);
        }

        .voice-button.recording {
            background-color: var(--error);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Profile Section */
        .profile-container {
            display: flex;
            gap: 20px;
        }

        .profile-sidebar {
            flex: 1;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
        }

        .profile-content {
            flex: 2;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }

        .user-details h3 {
            margin-bottom: 5px;
        }

        .user-details p {
            color: var(--text-light);
        }

        .dreams-history {
            margin-top: 30px;
        }

        .dreams-list {
            margin-top: 20px;
        }

        .dream-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }

        .dream-item:hover {
            background-color: #f5f5f5;
        }

        .dream-date {
            font-weight: 600;
            color: var(--primary);
        }

        .dream-preview {
            color: var(--text-light);
            margin-top: 5px;
        }

        .dream-detail {
            display: none;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .dream-detail.active {
            display: block;
        }

        .chart-container {
            margin-top: 30px;
            height: 300px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
        }

        /* Notification styles */
        #notification-area {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }

        .notification {
            background-color: var(--card-bg);
            border-left: 4px solid var(--success);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            border-left-color: var(--error);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .chat-container, .profile-container {
                flex-direction: column;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .message {
                max-width: 90%;
            }
            
            .input-container {
                flex-direction: column;
                align-items: center;
            }
            
            .message-input {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-moon"></i>
                    <span>–°–æ–Ω–Ω–∏–∫</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-section="chat">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li><a href="#" class="nav-link" data-section="profile">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></li>
                        <li><a href="#" class="nav-link" data-section="about">–û –ø—Ä–æ–µ–∫—Ç–µ</a></li>
                    </ul>
                </nav>
                <div class="auth-buttons">
                    <button class="btn btn-outline btn-small" id="login-btn">–í–æ–π—Ç–∏</button>
                    <button class="btn btn-primary btn-small" id="register-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>
            </div>
        </div>
    </header>

    <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div id="notification-area"></div>

    <main class="container">
        <!-- Authentication Section -->
        <section id="auth-section" class="section">
            <h2 class="section-title">–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</h2>
            <div class="auth-container">
                <div class="auth-card">
                    <div class="auth-tabs">
                        <div class="auth-tab active" data-tab="login">–í—Ö–æ–¥</div>
                        <div class="auth-tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
                    </div>
                    
                    <form id="login-form" class="auth-form active">
                        <div class="form-group">
                            <label for="login-email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                            <input type="email" id="login-email" class="form-control" required>
                            <div class="error-message" id="login-email-error">–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email</div>
                        </div>
                        <div class="form-group">
                            <label for="login-password">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="login-password" class="form-control" required>
                            <div class="error-message" id="login-password-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">–í–æ–π—Ç–∏</button>
                    </form>
                    
                    <form id="register-form" class="auth-form">
                        <div class="form-group">
                            <label for="register-name">–ò–º—è</label>
                            <input type="text" id="register-name" class="form-control" required>
                            <div class="error-message" id="register-name-error">–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤</div>
                        </div>
                        <div class="form-group">
                            <label for="register-email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                            <input type="email" id="register-email" class="form-control" required>
                            <div class="error-message" id="register-email-error">–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email</div>
                        </div>
                        <div class="form-group">
                            <label for="register-birthdate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                            <input type="date" id="register-birthdate" class="form-control" required>
                            <div class="error-message" id="register-birthdate-error">–ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                        </div>
                        <div class="form-group">
                            <label for="register-password">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="register-password" class="form-control" required>
                            <div class="password-strength">
                                <div class="password-strength-bar" id="password-strength-bar"></div>
                            </div>
                            <div class="error-message" id="register-password-error">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤, –≤–∫–ª—é—á–∞—è —Ü–∏—Ñ—Ä—ã –∏ –±—É–∫–≤—ã</div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Chat Section -->
        <section id="chat-section" class="section active">
            <h2 class="section-title">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –≤–∞—à–∏—Ö —Å–Ω–æ–≤</h2>
            <div class="chat-container">
                <div class="chat-messages">
                    <div class="messages-container" id="messages-container">
                        <div class="message bot-message">
                            <div class="message-text">
                                –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç–≤–æ–∏ —Å–Ω—ã. –û–ø–∏—à–∏, —á—Ç–æ —Ç–µ–±–µ –ø—Ä–∏—Å–Ω–∏–ª–æ—Å—å, –∏ —è –¥–∞–º –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é.
                            </div>
                            <div class="message-time" id="welcome-time"></div>
                        </div>
                    </div>
                </div>
                <!-- –£–±—Ä–∞–Ω–∞ –±–µ–ª–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ -->
                <div class="input-container">
                    <textarea class="message-input" id="message-input" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–≤–æ–π —Å–æ–Ω..."></textarea>
                    <button class="voice-button" id="voice-button">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="send-button" id="send-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile-section" class="section">
            <h2 class="section-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
            <div class="profile-container">
                <div class="profile-sidebar">
                    <div class="user-info">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-details">
                            <h3 id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
                            <p id="user-email">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                            <p id="user-birthdate">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        </div>
                    </div>
                    <div class="dreams-history">
                        <h3>–ò—Å—Ç–æ—Ä–∏—è —Å–Ω–æ–≤</h3>
                        <div class="dreams-list" id="profile-dreams-list">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</div>
                        </div>
                    </div>
                </div>
                <div class="profile-content">
                    <div class="dream-detail active" id="dream-detail-default">
                        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–Ω –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π</h3>
                        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π —Å–æ–Ω –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ–≥–æ –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é.</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="dream-chart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about-section" class="section">
            <h2 class="section-title">–û –ø—Ä–æ–µ–∫—Ç–µ "–°–æ–Ω–Ω–∏–∫"</h2>
            <div style="max-width: 800px; margin: 0 auto; background-color: var(--card-bg); padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                <p>–°–æ–Ω–Ω–∏–∫ - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ —Å–Ω–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.</p>
                <h3 style="margin-top: 20px; color: var(--primary);">–ù–∞—à–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</h3>
                <ul style="margin-top: 15px; margin-left: 20px;">
                    <li>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ –∏ –æ–±—Ä–∞–∑–æ–≤ –∏–∑ –≤–∞—à–∏—Ö —Å–Ω–æ–≤</li>
                    <li>–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è —Å–Ω–∞</li>
                    <li>–ì–æ–ª–æ—Å–æ–≤–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π</li>
                    <li>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç—ã—Ö —Ç–µ–º –∏ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –≤–∞—à–∏—Ö —Å–Ω–∞—Ö</li>
                    <li>–ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –≤–∞—à–∏—Ö —Å–Ω–æ–≤ –∏ –∏—Ö –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π</li>
                </ul>
                <h3 style="margin-top: 20px; color: var(--primary);">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h3>
                <p style="margin-top: 15px;">–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π n8n –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π –≤–∞—à–∏—Ö —Å–Ω–æ–≤.</p>
            </div>
        </section>
    </main>

    <script>
        // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –¥–µ–º–æ-—Ä–µ–∂–∏–º–æ–º
        const API_CONFIG = {
            demoMode: false, // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –Ω–∞ false, –∫–æ–≥–¥–∞ n8n –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω
            baseUrl: 'https://primary-production-d193.up.railway.app',
            webhookPath: '/webhook-test/0a1a369b-5e24-42a5-8296-4f5846f2a290'
        };

        // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentUser = null;
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ localStorage
        const MESSAGE_STORAGE_KEY = 'sonnik_chat_messages';
        const DREAMS_STORAGE_KEY = 'sonnik_user_dreams';

        // DOM Elements
        const authSection = document.getElementById('auth-section');
        const chatSection = document.getElementById('chat-section');
        const profileSection = document.getElementById('profile-section');
        const aboutSection = document.getElementById('about-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const messagesContainer = document.getElementById('messages-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const voiceButton = document.getElementById('voice-button');
        const passwordInput = document.getElementById('register-password');
        const passwordStrengthBar = document.getElementById('password-strength-bar');
        const profileDreamsList = document.getElementById('profile-dreams-list');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');
        const userBirthdate = document.getElementById('user-birthdate');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.getElementById('notification-area').appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function addLoadingMessage() {
            const loadingMsg = document.createElement('div');
            loadingMsg.className = 'message bot-message';
            loadingMsg.innerHTML = `
                <div class="message-text">
                    <i class="fas fa-spinner fa-spin"></i> –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Å–æ–Ω...
                </div>
                <div class="message-time">${new Date().getHours()}:${(new Date().getMinutes() < 10 ? '0' : '') + new Date().getMinutes()}</div>
            `;
            messagesContainer.appendChild(loadingMsg);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            return loadingMsg;
        }

        // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function removeLoadingMessage(loadingMsg) {
            if (loadingMsg && loadingMsg.parentNode) {
                messagesContainer.removeChild(loadingMsg);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ localStorage
        function saveMessageToStorage(message, sender) {
            const messages = getMessagesFromStorage();
            messages.push({
                text: message,
                sender: sender,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem(MESSAGE_STORAGE_KEY, JSON.stringify(messages));
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ localStorage
        function getMessagesFromStorage() {
            const messages = localStorage.getItem(MESSAGE_STORAGE_KEY);
            return messages ? JSON.parse(messages) : [];
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ localStorage
        function loadMessagesFromStorage() {
            const messages = getMessagesFromStorage();
            // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö
            if (messages.length === 0) return;
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            messagesContainer.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const welcomeMsg = document.createElement('div');
            welcomeMsg.className = 'message bot-message';
            welcomeMsg.innerHTML = `
                <div class="message-text">
                    –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç–≤–æ–∏ —Å–Ω—ã. –û–ø–∏—à–∏, —á—Ç–æ —Ç–µ–±–µ –ø—Ä–∏—Å–Ω–∏–ª–æ—Å—å, –∏ —è –¥–∞–º –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é.
                </div>
                <div class="message-time">${new Date().getHours()}:${(new Date().getMinutes() < 10 ? '0' : '') + new Date().getMinutes()}</div>
            `;
            messagesContainer.appendChild(welcomeMsg);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            messages.forEach(msg => {
                addMessageToDOM(msg.text, msg.sender, new Date(msg.timestamp));
            });
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        document.getElementById('welcome-time').textContent = new Date().getHours() + ':' + 
            (new Date().getMinutes() < 10 ? '0' : '') + new Date().getMinutes();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ localStorage
            loadMessagesFromStorage();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            const token = localStorage.getItem('authToken');
            if (token) {
                // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∞—Ç
                currentUser = {
                    name: localStorage.getItem('userName') || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    email: localStorage.getItem('userEmail') || 'user@example.com',
                    birthdate: localStorage.getItem('userBirthdate') || '1990-01-01'
                };
                showChatSection();
            }
        });

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = link.getAttribute('data-section') + '-section';
                
                navLinks.forEach(nav => nav.classList.remove('active'));
                link.classList.add('active');
                
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId).classList.add('active');
                
                if (sectionId === 'profile-section' && currentUser) {
                    loadProfileData();
                }
            });
        });

        // –ö–Ω–æ–ø–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        loginBtn.addEventListener('click', showAuthSection);
        registerBtn.addEventListener('click', showAuthSection);

        function showAuthSection() {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            authSection.classList.add('active');
            
            navLinks.forEach(nav => nav.classList.remove('active'));
        }

        // –í–∫–ª–∞–¥–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        authTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                
                authTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                authForms.forEach(form => form.classList.remove('active'));
                document.getElementById(`${tabName}-form`).classList.add('active');
            });
        });

        // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
        passwordInput.addEventListener('input', () => {
            const password = passwordInput.value;
            let strength = 0;
            
            if (password.length >= 8) strength += 1;
            if (/\d/.test(password)) strength += 1;
            if (/[a-zA-Z]/.test(password)) strength += 1;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 1;
            
            passwordStrengthBar.className = 'password-strength-bar';
            if (strength === 0) {
            } else if (strength === 1) {
                passwordStrengthBar.classList.add('password-weak');
            } else if (strength === 2) {
                passwordStrengthBar.classList.add('password-medium');
            } else {
                passwordStrengthBar.classList.add('password-strong');
            }
        });

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!isValidEmail(email)) {
                document.getElementById('login-email-error').style.display = 'block';
                return;
            } else {
                document.getElementById('login-email-error').style.display = 'none';
            }
            
            if (password.length < 6) {
                document.getElementById('login-password-error').style.display = 'block';
                return;
            } else {
                document.getElementById('login-password-error').style.display = 'none';
            }
            
            // –î–µ–º–æ-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            demoLogin(email, password);
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const birthdate = document.getElementById('register-birthdate').value;
            const password = document.getElementById('register-password').value;
            
            let isValid = true;
            
            if (name.length < 2) {
                document.getElementById('register-name-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('register-name-error').style.display = 'none';
            }
            
            if (!isValidEmail(email)) {
                document.getElementById('register-email-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('register-email-error').style.display = 'none';
            }
            
            if (!isValidDate(birthdate)) {
                document.getElementById('register-birthdate-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('register-birthdate-error').style.display = 'none';
            }
            
            if (password.length < 8 || !/\d/.test(password) || !/[a-zA-Z]/.test(password)) {
                document.getElementById('register-password-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('register-password-error').style.display = 'none';
            }
            
            if (!isValid) return;
            
            // –î–µ–º–æ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            demoRegister(name, email, birthdate, password);
        });

        // –î–µ–º–æ-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        function demoLogin(email, password) {
            showNotification('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            localStorage.setItem('authToken', 'demo-token');
            localStorage.setItem('userEmail', email);
            localStorage.setItem('userName', email.split('@')[0]);
            
            currentUser = {
                name: email.split('@')[0],
                email: email,
                birthdate: '1990-01-01'
            };
            
            showChatSection();
        }

        // –î–µ–º–æ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        function demoRegister(name, email, birthdate, password) {
            showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            localStorage.setItem('authToken', 'demo-token');
            localStorage.setItem('userEmail', email);
            localStorage.setItem('userName', name);
            localStorage.setItem('userBirthdate', birthdate);
            
            currentUser = {
                name: name,
                email: email,
                birthdate: birthdate
            };
            
            showChatSection();
        }

        // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —á–∞—Ç–∞
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        function sendMessage() {
            const message = messageInput.value.trim();
            if (message === '') return;
            
            addMessageToDOM(message, 'user');
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            saveMessageToStorage(message, 'user');
            messageInput.value = '';
            
            // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è
            sendMessageToBot(message);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ DOM
        function addMessageToDOM(text, sender, timestamp = new Date()) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
            
            const messageText = document.createElement('div');
            messageText.classList.add('message-text');
            messageText.textContent = text;
            
            const messageTime = document.createElement('div');
            messageTime.classList.add('message-time');
            messageTime.textContent = timestamp.getHours() + ':' + 
                (timestamp.getMinutes() < 10 ? '0' : '') + timestamp.getMinutes();
            
            messageDiv.appendChild(messageText);
            messageDiv.appendChild(messageTime);
            
            if (sender === 'bot') {
                const ttsButton = document.createElement('button');
                ttsButton.classList.add('tts-button');
                ttsButton.innerHTML = '<i class="fas fa-volume-up"></i>';
                ttsButton.addEventListener('click', () => {
                    textToSpeech(text);
                });
                messageDiv.insertBefore(ttsButton, messageText);
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        async function sendMessageToBot(message) {
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingMsg = addLoadingMessage();

            // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –¥–µ–º–æ-—Ä–µ–∂–∏–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É
            if (API_CONFIG.demoMode) {
                setTimeout(() => {
                    removeLoadingMessage(loadingMsg);
                    const demoResponse = generateDemoResponse(message);
                    addMessageToDOM(demoResponse, 'bot');
                    saveMessageToStorage(demoResponse, 'bot');
                    updateDreamsList(message, demoResponse);
                }, 1000 + Math.random() * 2000);
                return;
            }

            // –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º
            try {
                // –ü–æ–ª—É—á–∞–µ–º –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –∏–∑ localStorage
                const email = localStorage.getItem('userEmail');
                const password = localStorage.getItem('userPassword');
                
                // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ n8n
                const response = await fetch(API_CONFIG.baseUrl + API_CONFIG.webhookPath, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('authToken')
                    },
                    body: JSON.stringify({
                        message,
                        email,
                        password,
                        userId: currentUser?.id
                    })
                });
                
                removeLoadingMessage(loadingMsg);
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + response.status);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    addMessageToDOM(data.response, 'bot', new Date());
                    saveMessageToStorage(data.response, 'bot');
                    loadDreamsList();
                } else {
                    throw new Error(data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
            } catch (error) {
                removeLoadingMessage(loadingMsg);
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ' + error.message, 'error');
                
                // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-–æ—Ç–≤–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                setTimeout(() => {
                    const demoResponse = "–≠—Ç–æ –¥–µ–º–æ-–æ—Ç–≤–µ—Ç. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ò–ò –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ n8n workflow.";
                    addMessageToDOM(demoResponse, 'bot', new Date());
                    saveMessageToStorage(demoResponse, 'bot');
                }, 1000);
            }
        }

        // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–µ–º–æ-–æ—Ç–≤–µ—Ç–æ–≤
        function generateDemoResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('–ª–µ—Ç–∞—Ç—å') || lowerMessage.includes('–ø–æ–ª—ë—Ç') || lowerMessage.includes('–ø–æ–ª–µ—Ç')) {
                return "–°–Ω—ã –æ –ø–æ–ª—ë—Ç–µ —á–∞—Å—Ç–æ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É—é—Ç —Å–≤–æ–±–æ–¥—É, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–ª–∏ –∂–µ–ª–∞–Ω–∏–µ —É–π—Ç–∏ –æ—Ç –ø—Ä–æ–±–ª–µ–º. –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ, —á—Ç–æ –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞–µ—Ç–µ –∫–∞–∫–∏–µ-—Ç–æ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –∂–∏–∑–Ω–∏.";
            } else if (lowerMessage.includes('–≤–æ–¥–∞') || lowerMessage.includes('—Ä–µ–∫–∞') || lowerMessage.includes('–º–æ—Ä–µ')) {
                return "–í–æ–¥–∞ –≤–æ —Å–Ω–µ —á–∞—Å—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —ç–º–æ—Ü–∏–∏ –∏ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ. –°–ø–æ–∫–æ–π–Ω–∞—è –≤–æ–¥–∞ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å –≥–∞—Ä–º–æ–Ω–∏—é, –∞ –±—É—Ä–Ω–∞—è - —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ—Ç—Ä—è—Å–µ–Ω–∏—è –∏–ª–∏ –Ω–µ—Ä–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.";
            } else if (lowerMessage.includes('–∂–∏–≤–æ—Ç–Ω—ã–µ') || lowerMessage.includes('–∑–≤–µ—Ä–∏') || lowerMessage.includes('–ø—Ç–∏—Ü—ã')) {
                return "–ñ–∏–≤–æ—Ç–Ω—ã–µ –≤–æ —Å–Ω–µ –º–æ–≥—É—Ç –æ—Ç—Ä–∞–∂–∞—Ç—å –≤–∞—à–∏ –∏–Ω—Å—Ç–∏–Ω–∫—Ç—ã –∏ –ø–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–µ –∂–µ–ª–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Å–ø–æ–º–Ω–∏—Ç—å, –∫–∞–∫ –≤—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞–ª–∏ —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏ –≤–æ —Å–Ω–µ - —ç—Ç–æ –º–æ–∂–µ—Ç –º–Ω–æ–≥–æ–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –≤–∞—à–∏—Ö —Ç–µ–∫—É—â–∏—Ö –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è—Ö.";
            } else if (lowerMessage.includes('–ø–æ–≥–æ–Ω—è') || lowerMessage.includes('–±–µ–≥') || lowerMessage.includes('—É–±–µ–≥–∞—Ç—å')) {
                return "–°–Ω—ã –æ –ø–æ–≥–æ–Ω–µ —á–∞—Å—Ç–æ —Å–≤—è–∑–∞–Ω—ã —Å —á—É–≤—Å—Ç–≤–æ–º —Ç—Ä–µ–≤–æ–≥–∏ –∏–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å—é —Ä–µ—à–∏—Ç—å –∫–∞–∫—É—é-—Ç–æ –ø—Ä–æ–±–ª–µ–º—É –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏. –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏–∑–±–µ–≥–∞–µ—Ç–µ —á–µ–≥–æ-—Ç–æ –≤–∞–∂–Ω–æ–≥–æ.";
            } else if (lowerMessage.includes('–¥–æ–º') || lowerMessage.includes('–∫–≤–∞—Ä—Ç–∏—Ä–∞') || lowerMessage.includes('–∫–æ–º–Ω–∞—Ç–∞')) {
                return "–î–æ–º –≤–æ —Å–Ω–µ —á–∞—Å—Ç–æ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–ª–∏ –ª–∏—á–Ω–æ—Å—Ç—å. –†–∞–∑–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã –º–æ–≥—É—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Ä–∞–∑–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –≤–∞—à–µ–π –∂–∏–∑–Ω–∏ –∏–ª–∏ –ø—Å–∏—Ö–∏–∫–∏.";
            } else {
                const responses = [
                    "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Å–æ–Ω! –ß—Ç–æ–±—ã –¥–∞—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é, —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –¥–µ—Ç–∞–ª—è—Ö –∏ —ç–º–æ—Ü–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–ª–∏ –≤–æ —Å–Ω–µ.",
                    "–≠—Ç–æ—Ç —Å–æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Å–ø–æ–º–Ω–∏—Ç—å —Å–∞–º—ã–µ —è—Ä–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –∏ –æ–ø–∏—Å–∞—Ç—å –∏—Ö –ø–æ–¥—Ä–æ–±–Ω–µ–µ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏.",
                    "–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è, —ç—Ç–æ—Ç —Å–æ–Ω –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è –∏–ª–∏ –Ω–µ—Ä–µ—à—ë–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ–±—Ä–∞–∑—ã –≤ –≤–∞—à–∏—Ö —Å–Ω–∞—Ö.",
                    "–°–Ω—ã —á–∞—Å—Ç–æ –æ—Ç—Ä–∞–∂–∞—é—Ç –Ω–∞—à–∏ –ø–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–µ –º—ã—Å–ª–∏ –∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–µ—Å—Ç–∏ –¥–Ω–µ–≤–Ω–∏–∫ —Å–Ω–æ–≤, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏."
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–Ω–æ–≤
        function updateDreamsList(dreamDescription, interpretation) {
            const dreams = JSON.parse(localStorage.getItem(DREAMS_STORAGE_KEY) || '[]');
            
            dreams.push({
                id: dreams.length + 1,
                date: new Date().toISOString(),
                description: dreamDescription,
                interpretation: interpretation,
                preview: dreamDescription.substring(0, 50) + '...'
            });
            
            localStorage.setItem(DREAMS_STORAGE_KEY, JSON.stringify(dreams));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ñ–∏–ª–µ, –µ—Å–ª–∏ –æ–Ω –æ—Ç–∫—Ä—ã—Ç
            if (profileSection.classList.contains('active')) {
                renderDreamsList(dreams, profileDreamsList);
            }
        }

        // –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
        voiceButton.addEventListener('click', toggleRecording);

        function toggleRecording() {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        function startRecording() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        mediaRecorder = new MediaRecorder(stream);
                        audioChunks = [];
                        
                        mediaRecorder.ondataavailable = event => {
                            audioChunks.push(event.data);
                        };
                        
                        mediaRecorder.onstop = () => {
                            // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
                            simulateVoiceRecognition();
                        };
                        
                        mediaRecorder.start();
                        isRecording = true;
                        voiceButton.classList.add('recording');
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:', error);
                        showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É', 'error');
                    });
            } else {
                showNotification('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ', 'error');
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                isRecording = false;
                voiceButton.classList.remove('recording');
            }
        }

        // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≥–æ–ª–æ—Å–∞
        function simulateVoiceRecognition() {
            const demoTexts = [
                "–ü—Ä–∏—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ —è –ª–µ—Ç–∞—é –Ω–∞–¥ –≥–æ—Ä–æ–¥–æ–º –∏ –≤–∏–∂—É –≤—Å–µ —Å –≤—ã—Å–æ—Ç—ã –ø—Ç–∏—á—å–µ–≥–æ –ø–æ–ª—ë—Ç–∞.",
                "–ú–Ω–µ —Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ —è –±–µ–≥—É –ø–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º—É –∫–æ—Ä–∏–¥–æ—Ä—É –∏ –Ω–µ –º–æ–≥—É –Ω–∞–π—Ç–∏ –≤—ã—Ö–æ–¥.",
                "–í–æ —Å–Ω–µ —è —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–ª —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏ –≤ –ª–µ—Å—É, –∏ –æ–Ω–∏ –¥–∞–≤–∞–ª–∏ –º–Ω–µ —Å–æ–≤–µ—Ç—ã.",
                "–ü—Ä–∏—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ —è –ø–ª–∞–≤–∞—é –≤ –æ–∫–µ–∞–Ω–µ —Å –¥–µ–ª—å—Ñ–∏–Ω–∞–º–∏ –∏ –¥—Ä—É–≥–∏–º–∏ –º–æ—Ä—Å–∫–∏–º–∏ –æ–±–∏—Ç–∞—Ç–µ–ª—è–º–∏.",
                "–ú–Ω–µ —Å–Ω–∏–ª—Å—è —Å—Ç–∞—Ä—ã–π –¥–æ–º –∏–∑ –º–æ–µ–≥–æ –¥–µ—Ç—Å—Ç–≤–∞, –Ω–æ –≤ –Ω—ë–º –±—ã–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–Ω—å—à–µ –Ω–µ –±—ã–ª–æ."
            ];
            
            const randomText = demoTexts[Math.floor(Math.random() * demoTexts.length)];
            messageInput.value = randomText;
            showNotification('–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ', 'success');
        }

        // –û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
        function textToSpeech(text) {
            // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä —Ä–µ—á–∏
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ru-RU';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
                showNotification('–û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ', 'success');
            } else {
                showNotification('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–∑–≤—É—á–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞', 'error');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–Ω–æ–≤
        function loadDreamsList() {
            const dreams = JSON.parse(localStorage.getItem(DREAMS_STORAGE_KEY) || '[]');
            renderDreamsList(dreams, profileDreamsList);
        }

        function renderDreamsList(dreams, container) {
            if (!dreams || dreams.length === 0) {
                container.innerHTML = '<div class="loading">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–Ω–æ–≤</div>';
                return;
            }
            
            container.innerHTML = '';
            
            dreams.forEach(dream => {
                const dreamItem = document.createElement('div');
                dreamItem.classList.add('dream-item');
                dreamItem.setAttribute('data-dream-id', dream.id);
                
                const dreamDate = document.createElement('div');
                dreamDate.classList.add('dream-date');
                dreamDate.textContent = new Date(dream.date).toLocaleDateString('ru-RU');
                
                const dreamPreview = document.createElement('div');
                dreamPreview.classList.add('dream-preview');
                dreamPreview.textContent = dream.preview;
                
                dreamItem.appendChild(dreamDate);
                dreamItem.appendChild(dreamPreview);
                
                dreamItem.addEventListener('click', () => {
                    loadDreamDetail(dream.id);
                });
                
                container.appendChild(dreamItem);
            });
        }

        async function loadDreamDetail(dreamId) {
            const dreams = JSON.parse(localStorage.getItem(DREAMS_STORAGE_KEY) || '[]');
            const dream = dreams.find(d => d.id === dreamId);
            
            if (dream) {
                renderDreamDetail(dream);
            }
        }

        function renderDreamDetail(dream) {
            const dreamDetailContainer = document.querySelector('.profile-content');
            
            document.querySelectorAll('.dream-detail').forEach(detail => {
                detail.classList.remove('active');
            });
            
            let dreamDetail = document.getElementById(`dream-detail-${dream.id}`);
            if (!dreamDetail) {
                dreamDetail = document.createElement('div');
                dreamDetail.classList.add('dream-detail');
                dreamDetail.id = `dream-detail-${dream.id}`;
                dreamDetailContainer.insertBefore(dreamDetail, document.querySelector('.chart-container'));
            }
            
            dreamDetail.innerHTML = `
                <h3>–°–æ–Ω –æ—Ç ${new Date(dream.date).toLocaleDateString('ru-RU')}</h3>
                <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${dream.description}</p>
                <p><strong>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:</strong> ${dream.interpretation}</p>
            `;
            
            dreamDetail.classList.add('active');
        }

        async function loadAnalytics() {
            // –î–µ–º–æ-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞
            renderAnalyticsChart({
                labels: ['–ü–æ–ª–µ—Ç', '–í–æ–¥–∞', '–ñ–∏–≤–æ—Ç–Ω—ã–µ', '–ü–æ–≥–æ–Ω—è', '–î–æ–º'],
                data: [12, 8, 6, 5, 4]
            });
        }

        function renderAnalyticsChart(analytics) {
            const ctx = document.getElementById('dream-chart').getContext('2d');
            
            if (window.dreamChart instanceof Chart) {
                window.dreamChart.destroy();
            }
            
            window.dreamChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: analytics.labels || ['–ü–æ–ª–µ—Ç', '–í–æ–¥–∞', '–ñ–∏–≤–æ—Ç–Ω—ã–µ', '–ü–æ–≥–æ–Ω—è', '–î–æ–º'],
                    datasets: [{
                        label: '–ß–∞—Å—Ç–æ—Ç–∞ —Ç–µ–º –≤ —Å–Ω–∞—Ö',
                        data: analytics.data || [12, 8, 6, 5, 4],
                        backgroundColor: [
                            'rgba(109, 93, 252, 0.7)',
                            'rgba(138, 79, 255, 0.7)',
                            'rgba(156, 39, 176, 0.7)',
                            'rgba(103, 58, 183, 0.7)',
                            'rgba(63, 81, 181, 0.7)'
                        ],
                        borderColor: [
                            'rgba(109, 93, 252, 1)',
                            'rgba(138, 79, 255, 1)',
                            'rgba(156, 39, 176, 1)',
                            'rgba(103, 58, 183, 1)',
                            'rgba(63, 81, 181, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '–¢–µ–º—ã —Å–Ω–æ–≤'
                            }
                        }
                    }
                }
            });
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showChatSection() {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            chatSection.classList.add('active');
            
            navLinks.forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-section="chat"]').classList.add('active');
            
            loginBtn.textContent = '–í—ã–π—Ç–∏';
            registerBtn.style.display = 'none';
            
            loginBtn.onclick = () => {
                localStorage.removeItem('authToken');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('userPassword');
                currentUser = null;
                loginBtn.textContent = '–í–æ–π—Ç–∏';
                registerBtn.style.display = 'block';
                showAuthSection();
            };
        }

        function loadProfileData() {
            if (currentUser) {
                userName.textContent = currentUser.name;
                userEmail.textContent = currentUser.email;
                userBirthdate.textContent = `–†–æ–¥–∏–ª—Å—è: ${new Date(currentUser.birthdate).toLocaleDateString('ru-RU')}`;
            }
            
            loadDreamsList();
            loadAnalytics();
        }

        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function isValidDate(dateString) {
            const date = new Date(dateString);
            return !isNaN(date.getTime());
        }
    </script>
</body>
</html>
